
<!DOCTYPE html> 
<html lang="es"> 

<!-- Mirrored from www.htmlya.com.ar/html5/temarios/descripcion.php?cod=172&punto=39&inicio=20 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 15 Sep 2015 16:33:09 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=ISO-8859-1" /><!-- /Added by HTTrack -->
<head>
<title>GEOLOCATION (tiempo de espera y captura de errores)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">    
<meta http-equiv="content-type" content="text/html; charset=iso-8859-1">
<meta name="keywords" content="html5, programación, webmaster, tutorial">
<meta name="description" content="El objetivo de este tutorial 
es presentar los conceptos básicos de HTML 5. Es objetivo prioritario respetar 
los estándares del W3C">
<meta name="author" content="Diego Moisset">
<link rel="stylesheet" type="text/css" href="../principal2.css">
<style>
html,body {
	background-color: #D3E9D0;
	font-family: sans-serif,arial;
	font-size: 1em;
}

h1 {
	font-size: 14pt;
	margin: 0%;
}
</style>

</head>

<body>

<div style="background-color: #AED7A8;max-width: 950px;	margin-left: auto;margin-right: auto;border-radius:7px;padding:10px">
<h1><span style="font-size:1em"><a href="../../html5.html">Temario del Tutorial</a></span>->39 - GEOLOCATION (tiempo de espera y captura de errores)</h1></div>

<br>

<div style="background-color: #AED7A8;max-width: 950px;	border-radius:7px;padding:10px;margin-left: auto;margin-right: auto">

<div style="display:block;float:left;margin: 5px;"> 
<script type="text/javascript"><!--
google_ad_client = "pub-4669394804436935";
/* 300x250, creado 6/11/08 novi */
google_ad_slot = "7481492727";
google_ad_width = 300;
google_ad_height = 250;
//-->
</script>
<script type="text/javascript"
src="../../../pagead2.googlesyndication.com/pagead/f.txt">
</script>

</div> 

<p>El método getCurrentPosition tiene otros dos parámetros opcionales:</p>
<pre>
  getCurrentPosition([funcion que recibe la coordenada],
                     [función que captura el error],
                     [objeto que configura parámetros iniciales]);
</pre>
<p>Por ejemplo una llamada válida a getCurrentPosition:</p>
<pre>
   navigator.geolocation.getCurrentPosition(mostrarCoordenada,errores,{timeout:50});
</pre>

<p>El segundo parámetro es el nombre de la función que eventualmente captura un error:</p>
<pre>
function errores(err) {
    if (err.code == err.TIMEOUT) 
        alert("Se ha superado el tiempo de espera");
    if (err.code == err.PERMISSION_DENIED)     
        alert("El usuario no permitió informar su posición");
    if (err.code == err.POSITION_UNAVAILABLE)                 
        alert("El dispositivo no pudo recuperar la posición actual");
    }
</pre>
<p>El objeto err que llega como parámetro a la función nos informa el tipo de error generado por el intento de obtener la geolocalización. Como vemos hay tres posibilidades de errores que se pueden generar:</p>
<ul>
<li>
  (TIMEOUT) : El primer error posible es que el tiempo de espera para obtener la posición haya expirado. Veremos que podemos especificar al método getCurrentPosition el tiempo máximo que tiene para obtener la posición.
</li>
<li>
  (PERMISSION_DENIED) : Se genera si el usuario no aprueba la obtención de la geolocalización.
</li>
<li>
  (POSITION_UNAVAILABLE) : Cuando el dispositivo (por ejemplo un GPS) genera error interno.
</li>
</ul>

<p>Otro concepto importante es que al llamar al método getCurrentPosition en el tercer parámetro podemos enviarle un objeto donde configuramos todos o alguno de sus atributos:</p>
<pre>
    timeout //Especificamos el tiempo máximo de espera (si no se especifica el tiempo es infinito)
    maximumAge  //El atributo maximumAge indica que la aplicación está dispuesto a aceptar una posición almacenada en el caché 
                  cuya edad no supere la cantidad de milisegundos indicado en esta propiedad.
                  Por defecto está configurada en cero. 
    enableHighAccuracy  //Con el valor true activa la alta presición (por defecto está configurado en cero)
</pre>
<p>La sintaxis para configurar algunos de dichos atributos:</p>
<pre>
   navigator.geolocation.getCurrentPosition(mostrarCoordenada,errores,{timeout:50,maximumAge:60000});
</pre>

<h3>Problema</h3>
<p>Confeccionar una aplicación que al presionar un botón obtenga la latitud y longitud de nuestra posición actual y luego solicitar a los servicios de Google Maps un mapa de dicha coordenada. Esperar solo 10 milisegundos y ver si se genera un error por el tiempo de espera. Disponer luego en el atributo timeout un valor mayor hasta que no se dispare el error de tiempo de espera.</p>
<h4>Solución</h4>

<pre class="recuadro">
&lt;!DOCTYPE HTML&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;title&gt;Prueba&lt;/title&gt;
  
&lt;script type="text/javascript"&gt;

    window.addEventListener('load', inicio, false);

    function inicio() {
        document.getElementById('obtener').addEventListener('click', recuperarLocalizacion, false);
    }

    function recuperarLocalizacion() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(mostrarCoordenada,errores,{timeout:50});
        } else {
            alert('El navegador no dispone la capacidad de geolocalización');
        }
    }
    
    function mostrarCoordenada(posicion) {
        var direccion = posicion.coords.latitude + "," + posicion.coords.longitude;
        var mapa = "http://maps.googleapis.com/maps/api/staticmap?center="
           +direccion+"&zoom=14&size=500x500&sensor=false";
        document.getElementById("dato").innerHTML = "&lt;img src='"+mapa+"'&gt;";    
    }
    
    function errores(err) {
        if (err.code == err.TIMEOUT) 
            alert("Se ha superado el tiempo de espera");
        if (err.code == err.PERMISSION_DENIED)     
            alert("El usuario no permitió informar su posición");
        if (err.code == err.POSITION_UNAVAILABLE)                 
            alert("El dispositivo no pudo recuperar la posición actual");
    }

        
&lt;/script&gt;  
  
&lt;/head&gt;
&lt;body&gt;
  &lt;input type="button" id="obtener" value="Obtener la localización actual en Google Maps"&gt;
  &lt;br&gt;
  &lt;div id="dato"&gt;&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre>

<p>Como podemos ver hemos fijado el tiempo de espera en 50 milisegundos, con lo que es muy probable que no demos tiempo al dispositivo a generar la posición:</p>
<pre>
            navigator.geolocation.getCurrentPosition(mostrarCoordenada,errores,{timeout:50});
</pre>

<p>La función errores la hemos pasado como parámetro cuando llamamos a getCurrentPosition y es en donde analizamos el tipo de error disparado:</p>
<pre>
    function errores(err) {
        if (err.code == err.TIMEOUT) 
            alert("Se ha superado el tiempo de espera");
        if (err.code == err.PERMISSION_DENIED)     
            alert("El usuario no permitió informar su posición");
        if (err.code == err.POSITION_UNAVAILABLE)                 
            alert("El dispositivo no pudo recuperar la posición actual");
    }
</pre>
<table width="700px">
<tr>
<td align="left">	
<script type="text/javascript"><!--
google_ad_client = "ca-pub-4669394804436935";
/* fondo-izquierda-grande */
google_ad_slot = "2944336362";
google_ad_width = 336;
google_ad_height = 280;
//-->
</script>
<script type="text/javascript"
src="../../../pagead2.googlesyndication.com/pagead/f.txt">
</script>

<script type="text/javascript"><!--
google_ad_client = "ca-pub-4669394804436935";
/* fondo-derecha-grande */
google_ad_slot = "7374535966";
google_ad_width = 336;
google_ad_height = 280;
//-->
</script>
<script type="text/javascript"
src="../../../pagead2.googlesyndication.com/pagead/f.txt">
</script>

</td>
</tr>
</table>


   <h2><a href="../index28fa.html?inicio=20">Retornar</a></h2>   

</div>

</body>


<!-- Mirrored from www.htmlya.com.ar/html5/temarios/descripcion.php?cod=172&punto=39&inicio=20 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 15 Sep 2015 16:33:09 GMT -->
</html>
