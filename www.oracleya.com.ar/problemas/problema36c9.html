

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>

<!-- Mirrored from www.oracleya.com.ar/problemas/problema.php?inicio=100&cod=270&punto=112 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 15 Sep 2015 15:10:37 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=ISO-8859-1" /><!-- /Added by HTTrack -->
<head>
<title>Ejercicios propuestos : Disparador (old y new)(Oracle)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="keywords" content="oracle, programación, sql, tutorial">
<meta name="description" content="El objetivo de este tutorial 
es presentar los conceptos básicos de Oracle.">
<meta name="author" content="Diego Moisset">
<meta http-equiv="content-type" content="text/html; charset=iso-8859-1">

<link href="../css/estilos.css" rel="stylesheet" type="text/css">

<style>
html,body {
	background-color: #D3E9D0;
	font-family: Trebuchet MS, Verdana, Arial, sans-serif;
	font-size: 10pt;
	text-align:center;
}

h1 {
	font-size: 14pt;
	margin: 0%;
}
pre {
  text-align:left;
  font-family:verdana,sans-serif;
}
.recuadro {
background-color:#ffffcc;
  text-align:left;
  font-family:verdana;

  border-width:0;
  padding:5px;

  border: 1px dotted #ffaa00;
}
.recuadrooculto {
  background-color:#ffffcc;
  text-align:left;
  font-family:verdana;

  border-width:0;
  padding:5px;
  border: 1px dotted #ffaa00;
  display: none;
}

</style>

<script language="JavaScript">
function abrirVentana()
{
  alto=(screen.availHeight/2)+100;
  ancho=screen.availWidth-10;	
  window.open('', 'ventanaForm', 'top=0,left=0,width='+ancho+',height='+alto+',resizable=yes,scrollbars=yes,menubar=no,status=yes,toolbar=yes,location=yes');  	
}

function VentanaTeorico(codigo)
{
  alto=400;
  window.open('../temarios/descripcion2ade4.html?cod='+codigo+'&origen=problema', '', 'top=0,left=0,width=800,height='+alto+',resizable=yes,scrollbars=yes,menubar=no');  	
}

function cambiar(nro)
{
  var lista=document.getElementsByTagName('pre');
  for(f=0;f<lista.length;f++)
  {
   if (nro==1)
   {
     if (lista[f].id=='solu1')
       lista[f].style.display='block';
   }
   else
     if (nro==2)
     {
       if (lista[f].id=='solu2')
         lista[f].style.display='block';
     }
	   
  }
  if (nro==1)
    document.getElementById('solucion1').style.display='none';
  if (nro==2)
    document.getElementById('solucion2').style.display='none';
}

</script>

</head>

<body>
<div class="upperleft">
  <div class="upperright">
    <div class="lowerleft">
      <div class="lowerright">

<table width="98%">
<tr>
<td> 
<h1>112 - Disparador (old y new)</h1></td>
<td align="right">
<!--<a href="http://www.sqlserverya.com.ar/publicidad/"><img border="0" style="margin:5px;padding-left:2px" src="../imagenes/publicidad.png"></a>	-->

</td>
</tr>
</table>

      </div>
    </div>
  </div>
</div>

<br>
<div class="upperleft">
  <div class="upperright">
    <div class="lowerleft">
      <div class="lowerright">
	  <table>
<tr>
<td align="left">
<script type="text/javascript"><!--
google_ad_client = "pub-4669394804436935";
/* 728x90, creado 1/09/10 - largo */
google_ad_slot = "4269167522";
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="../../pagead2.googlesyndication.com/pagead/f.txt">
</script>
</td>
</tr>
</table>		  

<b>Primer problema: </b><br><p>Un comercio almacena los datos de sus artículos para la venta en una tabla denominada "articulos" y controla las operaciones que se realizan en ella guardando ciertos datos en otra tabla denominada "control".</p>
<p>1- Elimine las tablas:</p>
<pre>
 drop table control;
 drop table articulos;
</pre>
<p>2- Cree las tablas con las siguientes estructuras:</p>
<pre>
 create table articulos(
  codigo number(6),
  descripcion varchar2(40),
  precio number (6,2),
  stock number(4)
 );

 create table control(
  usuario varchar2(30),
  fecha date,
  codigo number(6)
 );
</pre>
<p>3- Ingrese algunos registros en "articulos":</p>
<pre>
 insert into articulos values(100,'regla 20 cm.',5.4,100);
 insert into articulos values(102,'regla 40 cm.',15,80);
 insert into articulos values(109,'lapices color x12',6,150);
 insert into articulos values(130,'lapices color x6',4.5,100);
 insert into articulos values(200,'compas metal',21.8,50);
</pre>
<p>4- Cree un trigger a nivel de fila que se dispara "antes" que se ejecute un "insert" sobre la tabla "articulos". En el cuerpo del disparador se debe ingresar en la tabla "control", el nombre del usuario que realizó la inserción, la fecha y el código del articulo que se ha ingresado</p>
<p>5- Ingrese un nuevo registro en "articulos"</p>

<p>6- Vea qué se almacenó en "control"</p>

<p>7- Cree un disparador que calcule el código cada vez que se inserte un nuevo registro</p>
<p>8- Ingrese un nuevo registro en "articulos"</p>

<p>9- Vea qué se almacenó en "articulos".<br>
Note que ignora el valor de código ingresado y calcula el siguiente valor a partir del máximo existente.</p>

<p>10- Vea qué se almacenó en "control"</p>

<p>11- Ingrese un nuevo artículo sin especificar código</p>
<p>12- Vea qué se almacenó en "articulos"</p>

<p>13- Vea qué se almacenó en "control"</p>
<a href="javascript:cambiar(1)" id="solucion1">Ver solución</a>
<br><br>
<pre id="solu1" class="recuadrooculto">
 drop table control;
 drop table articulos;

 create table articulos(
  codigo number(6),
  descripcion varchar2(40),
  precio number (6,2),
  stock number(4)
 );

 create table control(
  usuario varchar2(30),
  fecha date,
  codigo number(6)
 );

 insert into articulos values(100,'regla 20 cm.',5.4,100);
 insert into articulos values(102,'regla 40 cm.',15,80);
 insert into articulos values(109,'lapices color x12',6,150);
 insert into articulos values(130,'lapices color x6',4.5,100);
 insert into articulos values(200,'compas metal',21.8,50);

 create or replace trigger tr_ingresar_art
  before insert
  on articulos
  for each row
  begin
   insert into control values(user,sysdate,:new.codigo);
  end tr_ingresar_art;

 insert into articulos values(200,'compas plastico',18.3,50);

 select *from control;

 create or replace trigger tr_codigo
 before insert
 on articulos
 for each row
 begin
   select max(codigo)+1 into :new.codigo from articulos;
   if :new.codigo is null then
    :new.codigo:=1;
   end if;
 end tr_codigo;

 insert into articulos values(200,'cuaderno rayado x12',6,200);

 select *from articulos;

 select *from control;

 insert into articulos (descripcion,precio,stock) values('cuaderno liso x12',5.5,200);

 select *from articulos;

 select *from control;</pre>
        <p>&nbsp;</p>
  
<table width="700px">
<tr>
<td align="left">	

<script type="text/javascript"><!--
google_ad_client = "ca-pub-4669394804436935";
/* fondo-izquierda-grande */
google_ad_slot = "2944336362";
google_ad_width = 336;
google_ad_height = 280;
//-->
</script>
<script type="text/javascript"
src="../../pagead2.googlesyndication.com/pagead/f.txt">
</script>

<script type="text/javascript"><!--
google_ad_client = "ca-pub-4669394804436935";
/* fondo-derecha-grande */
google_ad_slot = "7374535966";
google_ad_width = 336;
google_ad_height = 280;
//-->
</script>
<script type="text/javascript"
src="../../pagead2.googlesyndication.com/pagead/f.txt">
</script>

</td>
</tr>
</table>
	
	

<b>Segundo problema: </b><br><p>Una librería almacena los datos de sus libros en una tabla denominada "libros" y en otra denominada "ofertas", almacena los códigos y precios de los libros cuyo precio es inferior a $50.</p>
<p>1- Elimine las tablas:</p>
<pre>
 drop table libros;
 drop table ofertas;
</pre>
<p>2- Cree las tablas con las siguientes estructuras:</p>
<pre>
 create table libros(
  codigo number(6),
  titulo varchar2(40),
  autor varchar2(30),
  editorial varchar(20),
  precio number(6,2)
 );

 create table ofertas(
  codigo number(6),
  precio number(6,2)
 );
</pre>
<p>3- Ingrese algunos registros en "libros":</p>
<pre>
 insert into libros values(100,'Uno','Richard Bach','Planeta',25);
 insert into libros values(103,'El aleph','Borges','Emece',28);
 insert into libros values(105,'Matematica estas ahi','Paenza','Nuevo siglo',12);
 insert into libros values(120,'Aprenda PHP','Molina Mario','Nuevo siglo',55);
 insert into libros values(145,'Alicia en el pais de las maravillas','Carroll','Planeta',35);
</pre>
<p>4- Cree un trigger a nivel de fila que se dispare al ingresar un registro en "libros"; si alguno de los libros ingresados tiene un precio menor o igual a $30 debe ingresarlo en "ofertas"</p>
<p>5- Ingrese un libro en "libros" cuyo precio sea inferior a $30</p>

<p>6- Verifique que el trigger se disparó consultando "ofertas"</p>

<p>7- Ingrese un libro en "libros" cuyo precio supere los $30</p>

<p>8- Verifique que no se ingresó ningún registro en "ofertas"</p>

<p>9- Cree un trigger a nivel de fila que se dispare al modificar el precio de un libro. Si tal libro existe en "ofertas" y su nuevo precio ahora es superior a $30, debe eliminarse de "ofertas"; si tal libro no existe en "ofertas" y su nuevo precio ahora es inferior a $30, debe agregarse a "ofertas"</p>
<p>10- Aumente a más de $30 el precio de un libro que se encuentra en "ofertas"</p>

<p>11- Verifique que el trigger se disparó consultando "libros" y "ofertas"</p>
<p>12- Disminuya a menos de $31 el precio de un libro que no se encuentra en "ofertas"</p>
<p>13- Verifique que el trigger se disparó consultando "libros" y "ofertas"</p>
<p>14- Aumente el precio de un libro que no se encuentra en "ofertas"</p>
<p>15- Verifique que el trigger se disparó pero no se modificó "ofertas"</p>
<p>16- Cree un trigger a nivel de fila que se dispare al borrar un registro en "libros"; si alguno de los libros eliminados está en "ofertas", también debe eliminarse de dicha tabla.<p>

<p>17- Elimine un libro en "libros" que esté en "ofertas"</p>
<p>18- Verifique que el trigger se disparó consultando "libros" y "ofertas"</p>
<p>19- Elimine un libro en "libros" que No esté en "ofertas"</p>
<p>20- Verifique que el trigger se disparó consultando "libros" y "ofertas"</p>
<p>21- Cree una tabla llamada "control" que almacene el código, la fecha y el precio de un libro, antes elimínela por si existe</p>

<p>22- Cree un disparador que se dispare cada vez que se actualice el precio de un libro; el trigger debe ingresar en la tabla "control", el código del libro cuyo precio se actualizó, la fecha y el precio anterior.</p>
<p>23- Actualice el precio de un libro</p>
<p>24- Controle que el precio se ha modificado en "libros" y que se agregó un registro en "control"</p>
<p>25- Modifique nuevamente el precio del libro cambiado en el punto 11</p>
<p>26- Controle que el precio se ha modificado en "libros" y que se agregó un nuevo registro en "control"</p>
<p>27- Modifique el precio de varios libros en una sola sentencia que incluya al modificado anteriormente</p>
<p>28- Controle que el precio se ha modificado en "libros" y que se agregó un nuevo registro en "control"</p>
<p>29- Vea qué informa el diccionario "user_triggers" respecto del trigger anteriormente creado</p>
<br>
<a href="javascript:cambiar(2)" id="solucion2">Ver solución</a>
<pre id="solu2" class="recuadrooculto">
 drop table libros;
 drop table ofertas;

 create table libros(
  codigo number(6),
  titulo varchar2(40),
  autor varchar2(30),
  editorial varchar(20),
  precio number(6,2)
 );

 create table ofertas(
  codigo number(6),
  precio number(6,2)
 );

 insert into libros values(100,'Uno','Richard Bach','Planeta',25);
 insert into libros values(103,'El aleph','Borges','Emece',28);
 insert into libros values(105,'Matematica estas ahi','Paenza','Nuevo siglo',12);
 insert into libros values(120,'Aprenda PHP','Molina Mario','Nuevo siglo',55);
 insert into libros values(145,'Alicia en el pais de las maravillas','Carroll','Planeta',35);

 create or replace trigger tr_ingresar_libros_ofertas
 before insert
 on libros
 for each row
 begin
  if (:new.precio&lt;=30) then
   insert into ofertas values(:new.codigo,:new.precio);
  end if;
 end tr_ingresar_libros_ofertas;

 insert into libros values(150,'El experto en laberintos','Gaskin','Planeta',28);

  select *from ofertas;

 insert into libros values(155,'El gato con botas',null,'Planeta',38);

  select *from ofertas;

 create or replace trigger tr_modificar_libros_precio
 before update of precio
 on libros
 for each row
 begin
  if (:old.precio&lt;=30) and (:new.precio&gt;30) then
   delete from ofertas where codigo=:old.codigo;
  end if;
  if (:old.precio&gt;30) and (:new.precio&lt;=30) then
   insert into ofertas values(:new.codigo,:new.precio);
  end if;
 end tr_modificar_libros_precio;

 update libros set precio=50 where codigo=150;

  select *from libros;
  select *from ofertas;

 update libros set precio=30 where codigo=155;

  select *from libros;
  select *from ofertas;

 update libros set precio=precio+2 where codigo=150;

  select *from libros;
  select *from ofertas;

 create or replace trigger tr_eliminar_libros_ofertas
 before delete
 on libros
 for each row
 begin
   delete from ofertas where codigo=:old.codigo;
 end tr_eliminar_libros_ofertas;

 delete from libros where codigo=155;

  select *from libros;
  select *from ofertas;

 delete from libros where codigo=150;

  select *from libros;
  select *from ofertas;

 create table control(
  codigo number(6),
  fecha date,
  precio number(6,2)
 );

 create or replace trigger tr_actualizar_precio
  before update of precio
  on libros
  for each row
 begin
  insert into control values(:old.codigo,sysdate,:old.precio);
 end tr_actualizar_precio;

 update libros set precio=40 where codigo=120;

 select *from libros where codigo=120;
 select *from control;

 update libros set precio=45 where codigo=120;

 select *from libros where codigo=120;
 select *from control;

 update libros set precio=precio+(precio*0.5) where codigo&gt;=120;

 select *from libros where codigo&gt;120;
 select *from control;

 select *from user_triggers where trigger_name ='TR_ACTUALIZAR_PRECIO';
</pre>

		
<br>
   <h2><a href="../indexf6ce.html?inicio=100">Retornar</a></h2>   


      </div>
    </div>
  </div>
</div>



</body>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-628756-18");
pageTracker._trackPageview();
} catch(err) {}</script>

<!-- Mirrored from www.oracleya.com.ar/problemas/problema.php?inicio=100&cod=270&punto=112 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 15 Sep 2015 15:10:37 GMT -->
</html>
