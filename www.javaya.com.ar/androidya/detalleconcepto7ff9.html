<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" 
"http://www.w3.org/TR/html4/loose.dtd"> 
<html>


<!-- Mirrored from www.javaya.com.ar/androidya/detalleconcepto.php?codigo=155&inicio=20 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 15 Sep 2015 16:04:03 GMT -->
<head>
<title>Reproducción de audio (archivo localizado en internet)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="content-type" content="text/html; charset=iso-8859-1">
<meta name="keywords" content="tutorial android">
<meta name="description" content="Tutorial de Android">
<link href="css/estilos.css" rel="stylesheet" type="text/css">
<style>
html,body {
	background-color: #D3E9D0;
	font-family: Arial, sans-serif;
	font-size: 11pt;
	text-align:center;
}

h1 {
	margin: 0%;
}

.recuadro {
  background-color:#ffffcc;
  text-align:left;
  font-family:courier;
  font-size:1.2em;
  border-width:0;
  padding:5px;

  border: 1px dotted #ffaa00;
}

.recuadrooculto {
  background-color:#ffffcc;
  text-align:left;
  font-family:courier;

  border-width:0;
  padding:5px;

  border: 1px dotted #ffaa00;
  display: none;
}

 img {
   padding:11px;
 }
 
 li {
    padding:10px;
 }
.descarga2 a {
color:#4B4B4B;
text-decoration:none;
border-bottom:1px dotted #444;
}
.descarga2 {
background: #F7FABE;
text-align: left;
padding: 5px 20px 5px 45px;
border-top: 2px solid #DFE786;
border-bottom: 2px solid #DFE786;
color:#000000;
margin-left:1.2em;
margin-right:1.2em;
border-radius:4px;
font-size:1em;

}  

</style>

<script type="text/javascript">
function cambiar()
{
  var lista=document.getElementsByTagName('pre');
  for(f=0;f<lista.length;f++)
  {
   lista[f].style.display='block';
  }
  document.getElementById('solucion').style.display='none';
}

</script>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-628756-30']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

</head>

<body>

<div class="upperleft">
  <div class="upperright">
    <div class="lowerleft">
      <div class="lowerright">
<table width="98%">
<tr>
<td> 
<h1>25 - Reproducción de audio (archivo localizado en internet)</h1> <p class="descarga2">Ya se encuentra disponible el nuevo tutorial para aprender android con el nuevo entorno <a href="androidstudioya/index.html" target="_blank">Android Studio propuesto por Google y
que remplaza a Eclipse</a>.
</td>
<td align="right">

</td>
</tr>
</table>

      </div>
    </div>
  </div>
</div>
<br>


<div class="upperleft">
  <div class="upperright">
    <div class="lowerleft">
      <div class="lowerright">
 <div id="contentdetalle">

<div style="display:block;float:left;margin: 5px;"> 
 
<script async src="../../pagead2.googlesyndication.com/pagead/js/f.txt"></script>
<!-- propuesto-javaya -->
<ins class="adsbygoogle"
     style="display:inline-block;width:336px;height:280px"
     data-ad-client="ca-pub-4669394804436935"
     data-ad-slot="1400020364"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
 
</div> 

<p>Ahora vamos a ver los pasos para reproducir un archivo almacenado en un servidor de internet.</p>

<h3>Problema:</h3>
<p>Disponer un botón con la etiqueta: "Gato", luego cuando se presione reproducir el archivo de audio respectivo. El archivo de sonido se encuentra almacenado en http://www.codigofuenteya.com.ar/recursos/gato.mp3</p>
<p>El primer paso es modificar el archivo AndroidManifest.xml donde autorizamos a la aplicación a acceder a recursos localizados en internet:</p>
<img src="imagentema/foto098.jpg" border="0" alt="play mp3 android localizados en internet"><br>
<p>Creamos la interfaz de la aplicación e inicializamos el evento On click del Button con el método que implementaremos:</p>
<img src="imagentema/foto099.jpg" border="0" alt="play mp3 android localizados en internet"><br>


<p>El código fuente es:</p>
<pre class="recuadro">
package com.androidya.proyecto022;

import java.io.IOException;

import android.app.Activity;
import android.media.MediaPlayer;
import android.os.Bundle;
import android.view.Menu;
import android.view.View;

public class MainActivity extends Activity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
    }

    @Override
    public boolean onCreateOptionsMenu(Menu menu) {
        // Inflate the menu; this adds items to the action bar if it is present.
        getMenuInflater().inflate(R.menu.activity_main, menu);
        return true;
    }

    public void ejecutar(View v) {
        MediaPlayer mp = new MediaPlayer();
        try {
            mp.setDataSource("http://www.codigofuenteya.com.ar/recursos/gato.mp3");
            mp.prepare();
            mp.start();
        } catch (IOException e) {
        }
    }

}
</pre>

<p>Para recuperar un archivo mp3 de internet procedemos de la siguiente manera, primero creamos un objeto de la clase MediaPlayer:</p>
<pre>
         MediaPlayer mp=new MediaPlayer();
</pre>
<p>Luego llamamos al método setDataSource indicando la dirección de internet donde se almacena el archivo mp3:</p>
<pre>
             mp.setDataSource("http://www.codigofuenteya.com.ar/recursos/gato.mp3");
</pre>
<p>Llamamos al método prepare y seguidamente llamamos a start:</p>
<pre>
             mp.prepare();
             mp.start();
</pre>
<p>Todo esto lo hacemos en un bloque try/catch para capturar excepciones de tipo IOException.</p>
<p>Esta primera aproximación para ejecutar un mp3 localizado en internet bloquea la aplicación hasta que se carga por completo el archivo, es decir queda ejecutándose el método  mp.prepare() hasta que finaliza la recuperación en forma completa.</p>
<p>Este proyecto lo puede descargar en un zip desde este enlace:
<a href="proyectos/proyecto022.zip">proyecto022.zip</a><br>


<h3>Problema:</h3>
<p>Confeccionar otra aplicación similar a la anterior pero que no se congele la interfaz de la aplicación mientras se carga el mp3. Mostrar un mensaje que el archivo se está cargando.</p>
<p>Desarrollamos un nuevo proyecto, asignamos el permiso de acceder a internet en el archivo AndroidManifest.xmp y creamos una interfaz similar al problema anterior.</p>

<p>El código fuente es:</p>
<pre class="recuadro">
package com.androidya.proyecto023;

import java.io.IOException;

import android.app.Activity;
import android.media.MediaPlayer;
import android.media.MediaPlayer.OnPreparedListener;
import android.os.Bundle;
import android.view.Menu;
import android.view.View;
import android.widget.Toast;

public class MainActivity extends Activity  implements OnPreparedListener{
    MediaPlayer mp;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
    }

    @Override
    public boolean onCreateOptionsMenu(Menu menu) {
        // Inflate the menu; this adds items to the action bar if it is present.
        getMenuInflater().inflate(R.menu.activity_main, menu);
        return true;
    }

    public void ejecutar(View v) {
        mp = new MediaPlayer();
        mp.setOnPreparedListener(this);
        try {
            mp.setDataSource("http://www.codigofuenteya.com.ar/recursos/gato.mp3");
            mp.prepareAsync();
        } catch (IOException e) {
        }
        Toast t = Toast.makeText(this,
                "Espere un momento mientras se carga el mp3",
                Toast.LENGTH_SHORT);
        t.show();
    }

    public void onPrepared(MediaPlayer mp) {
        mp.start();
    }

}
</pre>
<p>Para poder capturar el evento que el archivo se terminó de recuperar debemos implementar la interface OnPreparedListener:</p>
<pre>
public class Proyecto023Activity extends Activity implements OnPreparedListener {
</pre>
<p>Con esto decimos que nuestra clase implementará el método onPrepared donde iniciamos la ejecución del mp3:</p>
<pre>
    public void onPrepared(MediaPlayer mp) {
        mp.start();
    }
</pre>
<p>En el evento click del botón creamos el objeto de la clase MediaPlayer, le pasamos al método setOnPreparedListener la dirección del objeto que capturará el evento de que el recurso está completo. Luego llamamos a los métodos setDataSource y prepareAsync para inicializar la carga del mp3. Finalmente mostramos un mensaje para informar al usuario que el archivo se está descargando:</p>
<pre>
    public void ejecutar(View v) {
        mp=new MediaPlayer();
        mp.setOnPreparedListener(this);                        
         try {         
             mp.setDataSource("http://www.codigofuenteya.com.ar/recursos/gato.mp3");
             mp.prepareAsync();    
         }catch(IOException e) {
         }
         Toast t=Toast.makeText(this,"Espere un momento mientras se carga el mp3", Toast.LENGTH_SHORT);
         t.show();         
    }
</pre>

<p>Este proyecto lo puede descargar en un zip desde este enlace:
<a href="proyectos/proyecto023.zip">proyecto023.zip</a><br>
</div>
<table width="700px">
<tr>
<td align="left">	

<script type="text/javascript"><!--
google_ad_client = "ca-pub-4669394804436935";
/* fondo-izquierda-grande */
google_ad_slot = "2944336362";
google_ad_width = 336;
google_ad_height = 280;
//-->
</script>
<script type="text/javascript"
src="../../pagead2.googlesyndication.com/pagead/f.txt">
</script>

<script type="text/javascript"><!--
google_ad_client = "ca-pub-4669394804436935";
/* fondo-derecha-grande */
google_ad_slot = "7374535966";
google_ad_width = 336;
google_ad_height = 280;
//-->
</script>
<script type="text/javascript"
src="../../pagead2.googlesyndication.com/pagead/f.txt">
</script>

</td>
</tr>
</table>

   <h2><a href="index28fa.html?inicio=20">Retornar</a></h2>   

  </div>
  
  
  
    </div>
  </div>
</div>




</body>


<!-- Mirrored from www.javaya.com.ar/androidya/detalleconcepto.php?codigo=155&inicio=20 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 15 Sep 2015 16:06:47 GMT -->
</html>
